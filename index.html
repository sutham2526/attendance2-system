<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Sarabun', sans-serif;
      background: #f7f9fc;
      margin: 0;
    }
    header {
      background: linear-gradient(90deg,#4facfe,#00f2fe);
      padding: 20px;
      text-align: center;
      color: white;
      font-size: 30px;
      font-weight: 600;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    .menu {
      display: flex;
      justify-content: space-around;
      margin: 20px;
      flex-wrap: wrap;
    }
    .menu button {
      flex: 1 1 200px;
      margin: 10px;
      padding: 25px;
      font-size: 20px;
      border: none;
      border-radius: 16px;
      color: white;
      cursor: pointer;
      font-weight: 600;
      transition: transform 0.2s;
    }
    .menu button:hover {transform: scale(1.05);}
    .btn-attendance {background: linear-gradient(45deg,#4caf50,#2e7d32);}
    .btn-manage {background: linear-gradient(45deg,#2196f3,#1565c0);}
    .btn-history {background: linear-gradient(45deg,#ff9800,#ef6c00);}
    .btn-report {background: linear-gradient(45deg,#9c27b0,#6a1b9a);}

    .card {
      background: white;
      margin: 20px;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    h2 {color:#333;}
    label {font-weight:600;}
    input, select, button.action {
      font-family: 'Sarabun', sans-serif;
      font-size: 18px;
      padding: 10px;
      margin: 5px 0;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      border-radius: 12px;
      overflow: hidden;
    }
    table th, table td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }
    table th {
      background: #e3f2fd;
    }
    .status-btn {
      width: 40px;
      height: 40px;
      line-height: 40px;
      border-radius: 50%;
      display: inline-block;
      text-align: center;
      margin: 2px;
      cursor: pointer;
      font-weight: bold;
      color: white;
      opacity: 0.5;
    }
    .status-btn.active {opacity: 1;}
    .‡∏°‡∏≤ {background: #4caf50;}
    .‡∏Ç‡∏≤‡∏î {background: #f44336;}
    .‡∏•‡∏≤‡∏Å‡∏¥‡∏à {background: #9c27b0;}
    .‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢ {background: #03a9f4;}
    .‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° {background: #ffeb3b; color:#333;}
    .hidden {display:none;}
  </style>
</head>
<body>
<header>üìò ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</header>

<div class="menu">
  <button class="btn-attendance" onclick="showPage('attendance')">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
  <button class="btn-manage" onclick="showPage('manage')">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
  <button class="btn-history" onclick="showPage('history')">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
  <button class="btn-report" onclick="showPage('report')">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</button>
</div>

<!-- Page: Attendance -->
<div id="attendance" class="card hidden">
  <h2>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
  <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
  <input type="date" id="attDate" onchange="resetAttendance()"><br>

  <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</label>
  <select id="attClass" onchange="resetAttendance()"></select><br>

  <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤:</label>
  <select id="attSubject" onchange="resetAttendance()"></select><br>

  <button class="action" onclick="loadStudents()">üìã ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</button>

  <table id="attTable" class="hidden">
    <thead>
      <tr><th>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</th><th>‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß</th><th>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th></tr>
    </thead>
    <tbody></tbody>
  </table>
  <button class="action" onclick="saveAttendance()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
</div>

<!-- Page: Manage Data -->
<div id="manage" class="card hidden">
  <h2>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
  <p>üîß ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô/‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô + ‡∏ß‡∏¥‡∏ä‡∏≤ + Import Excel</p>
  <input type="file" id="excelInput" accept=".xlsx,.xls" onchange="importExcel(event)">
  <table id="studentTable">
    <thead><tr><th>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</th><th>‡∏£‡∏´‡∏±‡∏™</th><th>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
    <tbody></tbody>
  </table>
</div>

<!-- Page: History -->
<div id="history" class="card hidden">
  <h2>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
  <p>üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á + ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô + ‡∏ß‡∏¥‡∏ä‡∏≤ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
</div>

<!-- Page: Report -->
<div id="report" class="card hidden">
  <h2>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</h2>
  <canvas id="reportChart"></canvas>
</div>

<script>
// ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á
let students = [];

// ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
function showPage(page){
  document.querySelectorAll('.card').forEach(c=>c.classList.add('hidden'));
  document.getElementById(page).classList.remove('hidden');
}

// Reset ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠
function resetAttendance(){
  document.querySelector('#attTable').classList.add('hidden');
  document.querySelector('#attTable tbody').innerHTML='';
}

// ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠
function loadStudents(){
  let date=document.getElementById('attDate').value;
  let cls=document.getElementById('attClass').value;
  let subj=document.getElementById('attSubject').value;
  if(!date||!cls||!subj){
    Swal.fire('‚ö†Ô∏è','‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö','warning');return;
  }
  let tbody=document.querySelector('#attTable tbody');
  tbody.innerHTML='';
  students.forEach(st=>{
    let tr=document.createElement('tr');
    tr.innerHTML=`<td>${st.no}</td><td>${st.id}</td><td>${st.name}</td><td>${renderStatusBtns()}</td>`;
    tbody.appendChild(tr);
  });
  document.getElementById('attTable').classList.remove('hidden');
}

// ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
function renderStatusBtns(){
  let statuses=[{k:'‡∏°‡∏≤',s:'/'},{k:'‡∏Ç‡∏≤‡∏î',s:'‡∏Ç'},{k:'‡∏•‡∏≤‡∏Å‡∏¥‡∏à',s:'‡∏•'},{k:'‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢',s:'‡∏õ'},{k:'‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°',s:'‡∏Å'}];
  return statuses.map(st=>`<span class="status-btn ${st.k}" onclick="setStatus(this,'${st.k}')">${st.s}</span>`).join('');
}

function setStatus(el,status){
  let td=el.parentNode;
  td.querySelectorAll('.status-btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
}

// Import Excel
function importExcel(e){
  let file=e.target.files[0];
  if(!file) return;
  let reader=new FileReader();
  reader.onload=function(evt){
    let data=new Uint8Array(evt.target.result);
    let workbook=XLSX.read(data,{type:'array'});
    let sheet=workbook.Sheets[workbook.SheetNames[0]];
    let rows=XLSX.utils.sheet_to_json(sheet,{header:1});
    students=rows.slice(1).map(r=>({no:r[0],id:r[1],name:r[2]}));
    renderStudentTable();
  };
  reader.readAsArrayBuffer(file);
}

function renderStudentTable(){
  let tbody=document.querySelector('#studentTable tbody');
  tbody.innerHTML='';
  students.forEach(st=>{
    let tr=document.createElement('tr');
    tr.innerHTML=`<td>${st.no}</td><td>${st.id}</td><td>${st.name}</td><td><button onclick="delStudent(${st.no})">‡∏•‡∏ö</button></td>`;
    tbody.appendChild(tr);
  });
}

function delStudent(no){
  students=students.filter(s=>s.no!==no);
  renderStudentTable();
}

// Save Attendance
function saveAttendance(){
  Swal.fire({title:'‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',allowOutsideClick:false,didOpen:()=>Swal.showLoading()});
  // TODO: ‡∏™‡πà‡∏á JSONP ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Apps Script URL
  setTimeout(()=>{
    Swal.close();
    Swal.fire('‚úÖ','‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß','success');
  },1500);
}

// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü
function renderReport(){
  let ctx=document.getElementById('reportChart');
  new Chart(ctx,{type:'pie',data:{
    labels:['‡∏°‡∏≤','‡∏Ç‡∏≤‡∏î','‡∏•‡∏≤‡∏Å‡∏¥‡∏à','‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢','‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°'],
    datasets:[{data:[12,3,4,2,1],backgroundColor:['#4caf50','#f44336','#9c27b0','#03a9f4','#ffeb3b']}]
  }});
}

// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
showPage('attendance');
renderReport();
</script>
</body>
</html>
