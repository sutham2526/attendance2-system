<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family: "Sarabun", sans-serif; background: #f7f9fc; margin:0; padding:0; }
    header { background: #4a90e2; padding: 15px; color:white; font-size: 22px; text-align:center; }
    nav { display: flex; justify-content:center; margin: 20px; }
    nav button { margin: 0 10px; padding: 10px 20px; border: none; border-radius: 8px; cursor:pointer; background:#50c878; color:white; font-size:16px; }
    section { display: none; padding: 20px; }
    .active { display:block; }
    table { border-collapse: collapse; width: 100%; margin-top:10px; background:white; }
    th, td { border:1px solid #ddd; padding:8px; text-align:left; }
    th { background:#4a90e2; color:white; }
    .btn { padding:6px 12px; border:none; border-radius:6px; cursor:pointer; }
    .btn-blue { background:#4a90e2; color:white; }
    .btn-red { background:#e94e77; color:white; }
    .btn-green { background:#50c878; color:white; }
    .popup { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:none; justify-content:center; align-items:center; }
    .popup-content { background:white; padding:20px; border-radius:10px; width:70%; max-height:80%; overflow:auto; }
  </style>
</head>
<body>
<header>üìö ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô + ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</header>

<nav>
  <button onclick="showSection('attendance')">‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</button>
  <button onclick="showSection('manageClasses')">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
</nav>

<!-- ‚úÖ ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô -->
<section id="attendance" class="active">
  <h2>‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
  <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</label>
  <select id="classSelect" onchange="loadStudentsForAttendance()"></select>
  <div id="attendanceArea"></div>
  <button class="btn btn-green" onclick="saveAttendance()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</button>
</section>

<!-- ‚úÖ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô -->
<section id="manageClasses">
  <h2>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
  <input type="text" id="newClassName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô">
  <button class="btn btn-green" onclick="addClass()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
  <div id="classList"></div>
</section>

<!-- ‚úÖ Popup ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ Excel -->
<div id="excelPopup" class="popup">
  <div class="popup-content">
    <h3>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏≤‡∏Å Excel</h3>
    <div id="excelPreview"></div>
    <button class="btn btn-green" onclick="confirmExcelImport()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    <button class="btn btn-red" onclick="closePopup()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
  </div>
</div>

<script>
let classrooms = {}; // { "‡∏°.3/1": [{id:"001",name:"‡∏™‡∏°‡∏ä‡∏≤‡∏¢"}, ...] }
let tempExcelData = [];

// ---------- ‡∏Å‡∏≤‡∏£‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ ----------
function showSection(id) {
  document.querySelectorAll("section").forEach(sec=>sec.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  if(id==="attendance") refreshClassSelect();
  if(id==="manageClasses") renderClasses();
}

// ---------- ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ----------
function addClass() {
  let name = document.getElementById("newClassName").value.trim();
  if(!name) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô");
  if(classrooms[name]) return alert("‡∏°‡∏µ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß");
  classrooms[name] = [];
  document.getElementById("newClassName").value="";
  renderClasses();
  refreshClassSelect();
}

function renderClasses() {
  let container = document.getElementById("classList");
  container.innerHTML="";
  for(let c in classrooms) {
    let div = document.createElement("div");
    div.innerHTML = `<b>${c}</b> (${classrooms[c].length})
      <button class='btn btn-blue' onclick="manageStudents('${c}')">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
      <button class='btn btn-red' onclick="deleteClass('${c}')">‡∏•‡∏ö</button>`;
    container.appendChild(div);
  }
}

function deleteClass(c) {
  if(confirm("‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô "+c+" ?")) {
    delete classrooms[c];
    renderClasses();
    refreshClassSelect();
  }
}

// ---------- ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ----------
function manageStudents(className) {
  let list = classrooms[className];
  let html = `<h3>‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á ${className}</h3>
    <input id="stuId" placeholder="‡∏£‡∏´‡∏±‡∏™">
    <input id="stuName" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•">
    <button class="btn btn-green" onclick="addStudent('${className}')">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
    <input type="file" id="excelFile" accept=".xlsx" onchange="importExcel(event,'${className}')">
    <table><tr><th>‡∏£‡∏´‡∏±‡∏™</th><th>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th></tr>`;
  list.forEach(s=> html+=`<tr><td>${s.id}</td><td>${s.name}</td></tr>`);
  html+="</table>";
  document.getElementById("classList").innerHTML = html;
}

function addStudent(className) {
  let id = document.getElementById("stuId").value.trim();
  let name = document.getElementById("stuName").value.trim();
  if(!id || !name) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠");
  classrooms[className].push({id,name});
  manageStudents(className);
}

// ---------- Import Excel ----------
function importExcel(e,className){
  let file = e.target.files[0];
  if(!file) return;
  let reader = new FileReader();
  reader.onload = function(ev){
    let data = new Uint8Array(ev.target.result);
    let wb = XLSX.read(data,{type:'array'});
    let ws = wb.Sheets[wb.SheetNames[0]];
    let json = XLSX.utils.sheet_to_json(ws,{header:1});
    tempExcelData = json.slice(1).map(r=>({id:r[0],name:r[1]})).filter(r=>r.id && r.name);
    showExcelPopup();
  };
  reader.readAsArrayBuffer(file);
}

function showExcelPopup(){
  document.getElementById("excelPreview").innerHTML = "<table><tr><th>‡∏£‡∏´‡∏±‡∏™</th><th>‡∏ä‡∏∑‡πà‡∏≠</th></tr>"+
    tempExcelData.map(r=>`<tr><td>${r.id}</td><td>${r.name}</td></tr>`).join("")+"</table>";
  document.getElementById("excelPopup").style.display="flex";
}
function closePopup(){ document.getElementById("excelPopup").style.display="none"; }
function confirmExcelImport(){
  // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡πÅ‡∏Å‡πâ‡πÑ‡∏î‡πâ)
  let lastClass = Object.keys(classrooms).slice(-1)[0];
  classrooms[lastClass].push(...tempExcelData);
  tempExcelData=[];
  closePopup();
  manageStudents(lastClass);
  renderClasses();
}

// ---------- ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠ ----------
function refreshClassSelect(){
  let sel = document.getElementById("classSelect");
  sel.innerHTML = "<option value=''>--‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô--</option>";
  for(let c in classrooms) sel.innerHTML+=`<option>${c}</option>`;
}

function loadStudentsForAttendance(){
  let c = document.getElementById("classSelect").value;
  if(!c) return;
  let list = classrooms[c];
  let html = `<h3>‡∏´‡πâ‡∏≠‡∏á ${c}</h3><table><tr><th>‡∏£‡∏´‡∏±‡∏™</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th></tr>`;
  list.forEach((s,i)=> {
    html+=`<tr><td>${s.id}</td><td>${s.name}</td>
    <td><input type='checkbox' id='att_${i}'></td></tr>`;
  });
  html+="</table>";
  document.getElementById("attendanceArea").innerHTML=html;
}

function saveAttendance(){
  let c = document.getElementById("classSelect").value;
  if(!c) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô");
  let list = classrooms[c];
  let records=[];
  list.forEach((s,i)=>{
    let status = document.getElementById("att_"+i).checked ? "‡∏°‡∏≤" : "‡∏Ç‡∏≤‡∏î";
    records.push({date:new Date().toLocaleString(), class:c, id:s.id, name:s.name, status});
  });
  console.log("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠:",records);
  alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ (‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Google Sheets ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà)");
}
</script>
</body>
</html>
