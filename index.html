<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>üéì Classroom Dashboard</title>

<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
:root{--bg:#f3f6fb;--card:#fff;--ink:#222;--muted:#6b7280;--grad:linear-gradient(90deg,#6a5acd,#00c6ff);
--green:#27ae60;--red:#c0392b;--yellow:#f1c40f;--purple:#8e44ad;--orange:#e67e22;--amber:#f39c12;--radius:16px;}
body{font-family:'Sarabun',sans-serif;margin:0;background:var(--bg);color:var(--ink);}
header{background:var(--grad); color:#fff; padding:18px 20px; text-align:center; box-shadow:0 6px 20px rgba(0,0,0,.15);}
header .title{font-size:22px;font-weight:700;}
.topbar{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;padding:14px 12px;background:#fff;position:sticky;top:0;z-index:5;box-shadow:0 2px 10px rgba(0,0,0,.06);}
.btn{border:0;padding:10px 16px;border-radius:12px;cursor:pointer;font-weight:600;background:var(--grad);color:#fff;transition:.2s;box-shadow:0 4px 10px rgba(0,0,0,.12);}
.btn.secondary{background:#eef2ff;color:#3b82f6;box-shadow:none;}
.btn.warn{background:#ffe8e8;color:#e11d48;}
.btn:hover{filter:brightness(.95);transform:translateY(-1px);}
.container{max-width:1200px;margin:20px auto;padding:0 16px;}
section{display:none;} section.active{display:block;}
.card{background:var(--card);border-radius:var(--radius);padding:20px;margin-bottom:18px;box-shadow:0 8px 24px rgba(0,0,0,.08);}
.card h3{margin:0 0 12px 0;}
.row{display:flex;gap:12px;flex-wrap:wrap;align-items:center;}
input[type="text"],input[type="number"],input[type="date"],select{padding:10px 12px;border-radius:12px;border:1px solid #e5e7eb;background:#fff;min-width:180px;font-size:16px;}
input[type="file"]{border:1px dashed #cbd5e1;padding:10px;border-radius:12px;background:#f8fafc;}
label{color:var(--muted);font-weight:600;margin-right:6px;}
.table-wrap{overflow:auto;border-radius:14px;box-shadow:0 3px 12px rgba(0,0,0,.06);}
table{width:100%;border-collapse:separate;border-spacing:0;background:#fff;}
th,td{padding:10px 12px;text-align:left;border-bottom:1px solid #f1f5f9;}
th{background:#f8fafc;color:#334155;position:sticky;top:0;z-index:1;}
tr:nth-child(even) td{background:#fcfdff;}
.badge{padding:6px 10px;background:#eef2ff;color:#4f46e5;border-radius:999px;font-size:12px;font-weight:700;}
.status-btn{display:inline-grid;place-items:center;width:36px;height:36px;border-radius:50%;color:#fff;font-weight:800;margin-right:6px;opacity:.35;cursor:pointer;border:2px solid transparent;transition:.15s;}
.status-btn:hover{transform:scale(1.03)}
.status-btn.active{opacity:1;box-shadow:0 0 0 3px rgba(0,0,0,.06);}
.‡∏°‡∏≤{background:var(--green)}
.‡∏Ç‡∏≤‡∏î{background:var(--red)}
.‡∏™‡∏≤‡∏¢{background:var(--yellow);color:#111}
.‡∏•‡∏≤‡∏Å‡∏¥‡∏à{background:var(--purple)}
.‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢{background:var(--orange)}
.‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°{background:var(--amber);color:#111}
.subtabs{display:flex;gap:8px;margin-bottom:12px;}
.subtabs .tab{padding:8px 12px;border-radius:10px;background:#eef2ff;color:#334155;cursor:pointer;font-weight:600;}
.subtabs .tab.active{background:var(--grad);color:#fff;}
.preview-table{max-height:50vh;overflow:auto;text-align:left;}
.preview-table table{min-width:520px;}
.footer-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:10px;}
.note{color:#64748b;font-size:12px;}
.kpi{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px;}
.kpi .card{display:flex;align-items:center;gap:12px;}
.kpi .dot{width:14px;height:14px;border-radius:50%;}
</style>
</head>
<body>

<header>
  <div class="title">üéì ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‚Äî Classroom Dashboard</div>
</header>

<div class="topbar">
  <button class="btn" onclick="openSection('attendance')">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
  <button class="btn" onclick="openSection('manage')">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
  <button class="btn" onclick="openSection('history')">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ & ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
  <button class="btn" onclick="openSection('export')">Export</button>
</div>

<div class="container">

  <!-- Attendance -->
  <section id="attendance" class="active">
    <div class="card">
      <h3>üìå ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
      <div class="row">
        <div>
          <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label><br/>
          <input type="date" id="attDate" />
        </div>
        <div>
          <label>‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label><br/>
          <select id="attRoom"></select>
        </div>
        <div>
          <label>‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</label><br/>
          <select id="attSubject"></select>
        </div>
        <div>
          <br/>
          <button class="btn" onclick="loadStudentsForAttendance()">‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</button>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="row" style="justify-content:space-between; align-items:center">
        <h3 style="margin:0">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
        <span class="badge" id="attCount">‚Äî</span>
      </div>
      <div class="table-wrap" id="attTableWrap">
        <table id="attTable">
          <thead>
            <tr>
              <th style="width:80px">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</th>
              <th style="width:140px">‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß</th>
              <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th>
              <th style="min-width:320px">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)</th>
            </tr>
          </thead>
          <tbody id="attBody"></tbody>
        </table>
      </div>
      <div class="footer-actions">
        <button class="btn" onclick="saveAttendance()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      </div>
    </div>
  </section>

  <!-- Manage Section -->
  <section id="manage">
    <div class="card">
      <h3>üõ† ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
      <div class="row">
        <input type="text" id="newID" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô">
        <input type="text" id="newName" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•">
        <select id="newRoom"></select>
        <button class="btn" onclick="addStudent()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
      </div>
    </div>
    <div class="table-wrap">
      <table id="manageTable">
        <thead>
          <tr><th>‡∏£‡∏´‡∏±‡∏™</th><th>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th><th>‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th><th>Action</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- History Section -->
  <section id="history">
    <div class="card">
      <h3>üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ & ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h3>
      <div class="row">
        <input type="date" id="histDate">
        <select id="histRoom"></select>
        <select id="histSubject"></select>
        <button class="btn" onclick="loadHistory()">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
      </div>
    </div>
    <div class="preview-table">
      <table id="histTable">
        <thead>
          <tr><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th><th>‡∏ß‡∏¥‡∏ä‡∏≤</th><th>‡∏£‡∏´‡∏±‡∏™</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <canvas id="chartHistory" height="120"></canvas>
  </section>

  <!-- Export Section -->
  <section id="export">
    <div class="card">
      <h3>üì§ Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
      <div class="footer-actions">
        <button class="btn" onclick="exportExcel()">Excel</button>
        <button class="btn" onclick="exportPDF()">PDF</button>
      </div>
    </div>
  </section>

</div>

<script>
const CURRENT_ATT = [];
const STUDENTS = [];

function openSection(sec){
  document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
  document.getElementById(sec).classList.add('active');
}

// Dummy data for demo
const ROOMS = ['‡∏°.1/1','‡∏°.1/2','‡∏°.2/1','‡∏°.3/1'];
const SUBJECTS = ['‡∏Ñ‡∏ì‡∏¥‡∏ï','‡∏ß‡∏¥‡∏ó‡∏¢‡πå','‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©','‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥'];

function loadRoomSubject(){
  const attRoom = document.getElementById('attRoom');
  const attSubject = document.getElementById('attSubject');
  const histRoom = document.getElementById('histRoom');
  const histSubject = document.getElementById('histSubject');
  const newRoom = document.getElementById('newRoom');

  attRoom.innerHTML = histRoom.innerHTML = newRoom.innerHTML = ROOMS.map(r=>`<option>${r}</option>`).join('');
  attSubject.innerHTML = histSubject.innerHTML = SUBJECTS.map(s=>`<option>${s}</option>`).join('');
}

// Attendance functions
function loadStudentsForAttendance(){
  const date = document.getElementById('attDate').value;
  const room = document.getElementById('attRoom').value;
  const subject = document.getElementById('attSubject').value;
  if(!date || !room || !subject){ Swal.fire('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà, ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô, ‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤'); return; }

  const filtered = STUDENTS.filter(s=>s.room===room);
  CURRENT_ATT.splice(0,CURRENT_ATT.length,...filtered.map(s=>({...s,status:'‡∏°‡∏≤'})));
  renderAttTable();
}

function renderAttTable(){
  const tbody = document.getElementById('attBody');
  tbody.innerHTML = '';
  CURRENT_ATT.forEach((s,i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${i+1}</td>
      <td>${s.id}</td>
      <td>${s.name}</td>
      <td>${['‡∏°‡∏≤','‡∏Ç‡∏≤‡∏î','‡∏™‡∏≤‡∏¢','‡∏•‡∏≤‡∏Å‡∏¥‡∏à','‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢','‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°'].map(st=>`
        <div class="status-btn ${st}" onclick="setStatus(${i},'${st}',this)">${st[0]}</div>
      `).join('')}</td>`;
    tbody.appendChild(tr);
    updateStatusUI(i);
  });
  document.getElementById('attCount').innerText = `${CURRENT_ATT.length} ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô`;
}

function setStatus(idx,status,el){
  CURRENT_ATT[idx].status = status;
  updateStatusUI(idx);
}

function updateStatusUI(idx){
  const row = document.getElementById('attBody').children[idx];
  row.querySelectorAll('.status-btn').forEach(b=>b.classList.remove('active'));
  const activeBtn = row.querySelector(`.status-btn.${CURRENT_ATT[idx].status}`);
  if(activeBtn) activeBtn.classList.add('active');
}

function saveAttendance(){
  if(!CURRENT_ATT.length){ Swal.fire('‚ö†Ô∏è ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô'); return; }
  Swal.fire('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!');
}

// Manage functions
function addStudent(){
  const id = document.getElementById('newID').value.trim();
  const name = document.getElementById('newName').value.trim();
  const room = document.getElementById('newRoom').value;
  if(!id || !name){ Swal.fire('‚ö†Ô∏è ‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠'); return; }
  STUDENTS.push({id,name,room});
  renderManageTable();
  document.getElementById('newID').value=''; document.getElementById('newName').value='';
}

function renderManageTable(){
  const tbody = document.querySelector('#manageTable tbody');
  tbody.innerHTML = '';
  STUDENTS.forEach((s,i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${s.id}</td><td>${s.name}</td><td>${s.room}</td>
      <td><button class="btn warn" onclick="STUDENTS.splice(${i},1);renderManageTable()">‡∏•‡∏ö</button></td>`;
    tbody.appendChild(tr);
  });
}

// History functions (dummy)
function loadHistory(){
  const tbody = document.querySelector('#histTable tbody');
  tbody.innerHTML = '';
  CURRENT_ATT.forEach(s=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>2025-08-25</td><td>${s.room}</td><td>‡∏Ñ‡∏ì‡∏¥‡∏ï</td><td>${s.id}</td><td>${s.name}</td><td>${s.status}</td>`;
    tbody.appendChild(tr);
  });
  // Chart
  const ctx = document.getElementById('chartHistory').getContext('2d');
  new Chart(ctx,{type:'pie',data:{labels:['‡∏°‡∏≤','‡∏Ç‡∏≤‡∏î','‡∏™‡∏≤‡∏¢','‡∏•‡∏≤‡∏Å‡∏¥‡∏à','‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢','‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°'],datasets:[{data:[2,1,0,0,0,0],backgroundColor:['#27ae60','#c0392b','#f1c40f','#8e44ad','#e67e22','#f39c12']}]},options:{responsive:true}});
}

// Export
function exportExcel(){
  const wb = XLSX.utils.book_new();
  const ws = XLSX.utils.table_to_sheet(document.getElementById('attTable'));
  XLSX.utils.book_append_sheet(wb,ws,'Attendance');
  XLSX.writeFile(wb,'Attendance.xlsx');
}
function exportPDF(){
  html2pdf().from(document.getElementById('attTableWrap')).save('Attendance.pdf');
}

document.addEventListener('DOMContentLoaded',()=>{
  loadRoomSubject();
  document.getElementById('attDate').valueAsDate = new Date();
});
</script>
</body>
</html>
